# -*- mode:org -*-
#+TITLE: Word-sense annotation in Emacs

This project intends to finish the word-sense annotations of the
[[http://wordnetcode.princeton.edu/glosstag.shtml][WordNet gloss corpus]], but can be used to sense-tag any corpus in the
S-expression-based format we have defined.


* Installation
See the =INSTALL= file.


* Usage
You should set the directory where the files to be annotated are with
=M-x customize-variable RET sensetion-annotation-dir=. (You can
customize other stuff with =M-x customize-group RET sensetion=.)

Use =M-x sensetion= to start annotating. If this is the first time you
call it, it might take some time to index the files (you can do other
stuff on Emacs while it works); else it'll read the index files (which
lie by default in your home directory, prefixed by =.sensetion-=), and
start the annotation process.

=M-x sensetion-annotate= will ask you for a lemma and a PoS tag. You
can press =TAB= for completion of the lemma. This will build a buffer
with instances of this lemma+pos that have not been annotated
yet. Unannotated words will show as red/pink, while
previously-annotated tokens will show as green, and newly-annotated
tokens will show as blue (all these colors can be customized by the
user). For annotated tokens, dark colours indicate confidence in the
annotation. You can navigate through annotatable tokens with =<= and
=>=.

If you wish to sense-tag a token, press =/= on it. You may select one
or many senses -- or no sense at all -- by pressing the appropriate
keyboard key. Senses which are already selected are prefixed by a plus
sign (=+=); when satisfied, press enter/return. If you'd like to quit,
press =q=; note that quitting does not undo anything (if you selected
an option and then quit, its effects were already carried out and
saved). You can see how many tokens still need to be annotated in the
mode-line, next to the =sensetion= indicator.

If you wish to change a token's lemma use =l=. If you wish to say a
token is not annotatable (i.e., ignore it), use =i=. If you wish to
say you are unsure about an annotation, use =?=.

There is support for word collocations, such as phrasal verbs. The
tokens part of a collocation are united by a key, which is shown in
their bottom left corner.  You can unglob a collocation by pressing
=u= in any token of the collocation.  To glob tokens, you mark them
with =m= and finally press =g= to create the collocation. If you
marked a token by mistake, you can unmark tokens by pressing =m=
again.

You can move sentences up or down with =C-↑= and =C-↓=. Clustering
tokens with the same sense together might be useful.

** Command summary
You can call a command using =M-x <command-name>= or by pressing its
keybinding.
| command name                | key binding | description                                                       |
|-----------------------------+-------------+-------------------------------------------------------------------|
| sensetion                   | -           | Start sensetion annotation process.                               |
| sensetion-annotate          | -           | Start annotating a new lemma/PoS tag.                             |
| sensetion-edit-sent         | =.=         | Edit sentence source data (be careful!)                           |
| sensetion-edit-sense        | =/=         | Annotate sense of selected token at point                         |
| sensetion-edit-lemma        | =l=         | Annotate lemma of token at point                                  |
| sensetion-edit-ignore       | =i=         | Marks file as to be ignored in the annotation process             |
| sensetion-edit-unsure       | =?=         | Marks annotation as done with little confidence                   |
| sensetion-toggle-glob-mark  | =m=         | Mark/Unmark token for globbing                                    |
| sensetion-glob              | =g=         | Glob the marked tokens as a new collocation and ask for its lemma |
| sensetion-unglob            | =u=         | Unglob collocation of token at point (removes collocation)        |
| sensetion-next-selected     | =>=         | Move point to next selected token                                 |
| sensetion-previous-selected | =<=         | Move point to previous selected token                             |
| sensetion-move-line-up      | =C-↑=       | Move sentence up                                                  |
| sensetion-move-line-down    | =C-↓=       | Move sentence down                                                |


** Indexing
If the index goes out of sync, you can force a new indexation with
=M-x sensetion-make-index=.


** Saving your work
- Any annotations are saved to their files at the moment they are
  done.
- The updated index is saved by default to your home directory in
  =.sensetion-index= when you quit emacs gracefully (that's why it
  hangs a little). This path is customizable.


** Seeing your work
We recommend (although it is not strictly necessary) setting up a git
repository for the annotation files (see any git tutorial if you are
unfamiliar with it). Use
: git diff --color-words=.
(note the period =.=) to see the changes you made after the previous
commit.

In any case, please back up your work!


* Report bugs
- Give clear instructions to reproduce the bug;
- Call =M-x toggle-debug-on-error=, reproduce the bug, and send the
  backtrace with your report (you may open an [[https://github.com/own-pt/sensetion.el/issues][issue]]).


* Annotation format
We convert the original XML files to property lists.

** conversion from original XML
The script that converts the original XML WN gloss corpus is at
=convert.lisp=. The MISC field of the annotation files saves lots of
information from the XML to preserve a mapping between them.

To re-run the conversion:

- download the [[http://wordnetcode.princeton.edu/glosstag.shtml][WordNet gloss corpus]];
  - you can validate it with the =xmllint= utility from the =libxml=
    package:
    : xmllint --dtdvalid dtd/glosstag.dtd merged/*.xml
- download the [[http://wordnetcode.princeton.edu/3.0/WNdb-3.0.tar.gz][WordNet 3.0 database files]];
- download and setup [[http://www.sbcl.org/][sbcl]] (although any common lisp implementation
  should work);
- setup [[https://www.quicklisp.org/beta/][quicklisp]];
- run:
  : ./convert.sh ~/WordNet-3.0/glosstag/merged/ ~/WordNet-3.0/dict/index.sense glosstag/
  where the first parameter is a directory is from the gloss corpus
  archive, the last parameter is the directory is where you want to
  put the files, and the second parameter is the index.sense file from
  the WordNet database. (Use absolute paths if you have problems with
  the command.) Note that the trailing slash in =glosstag/= is
  important. You must have the glosstag DTD in the same directory as
  the annotation files.


* Status
Under heavy development -- user interface is unstable, and the code is
still to be generalized so that it can be made useful for annotation
of other corpora (maybe even of other stuff).

