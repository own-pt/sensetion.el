# -*- mode:org -*-
#+TITLE: Word-sense annotation in Emacs

This project intends to finish the word-sense annotations of the
[[http://wordnetcode.princeton.edu/glosstag.shtml][WordNet gloss corpus]], but can be used to sense-tag any corpus in the
S-expression-based format we have defined.

* Usage
You must set the directory where the files to be annotated are with
=M-x customize-variable RET sensetion-annotation-dir=. (You can
customize other stuff with =M-x customize-group RET sensetion=.)

Use =M-x sensetion= to start annotating. If this is the first time you
call it, it might take some time to index the files (and freeze your emacs for this
time).

=M-x sensetion-annotate= will ask you for a lemma and a PoS tag and
will build a buffer with instances of this lemma+pos that have not
been annotated yet. You can navigate through taggable tokens with =<=
and =>=. If you wish to annotate a token, press =/= on it. If you'd

There is support for word collocations, such as phrasal verbs. The tokens part
of a collocation are united by a key, which is shown in their bottom left corner.
You can unglob a collocation by pressing =u= in any token of the collocation.
To glob tokens, you mark them with =m= and finally press =g= to create the collocation.

You can move sentences up or down with =C-↑= and =C-↓=. Clustering
tokens with the same sense together might be useful.


* Installation
You need both elisp libraries and the =wn= executable.

** elisp
- make sure you have MELPA set up, so that you can download
  dependencies easily.
- to make things easier, install =use-package= with =M-x
  install-package RET use-package=.
- clone this repository.


- add the following snippet to your user configuration file (usually
  at =~/emacs.d/init.el=), substituting the paths to the appropriate
  ones:
  #+BEGIN_SRC elisp
    (use-package hydra :defer t :ensure t)
    (use-package flycheck :defer t :ensure t)
    (use-package s :defer t :ensure t)
    (use-package f :defer t :ensure t)

    (use-package conllu-mode
      :mode "\\.conllu\\'"
      :load-path "~/conllu-mode/"


    (use-package sensetion
      :commands sensetion
      :load-path "~/sensetion.el/")
  #+END_SRC
  this will ensure the dependencies are installed and that the
  packages are properly loaded at the right time.
- restart emacs (or reload or your init file).

** wn
You may download the =wn= executable from your favorite package
manager. Be aware that package managers usually offer WordNet 3.1, and
not WordNet 3.0, which is the WordNet we use to annotate the WN gloss
corpus. If that is the case, download [[http://wordnetcode.princeton.edu/3.0/WNdb-3.0.tar.gz][WordNet 3.0 database files]], and
move them to the corresponding directory of package you installed.


* Annotation format
- update this section
Files to be annotated are syntactically the same to [[http://universaldependencies.org/format.html][CoNLL-U]] files, but
we have re-purposed their fields like below:

- LEMMA :: contains a pipe-separated (=|=) list of either lemmas or
           lemma+synset-type. spaces are substituted for underlines
           =_=, synset-types are integers encoding the lemma's PoS,
           and are rendered with a percent sign for separation, as in
           =living%3=.
- UPOS :: contain the annotation status defined by the WN gloss corpus
          (one of =ignore=, =auto=, =un=).
- XPOS :: contains the one-character alphabetic key to a collocation;
          all tokens in a collocation have the same key.
- FEATS :: contains a list of synset pairs; the key for a synset is
           =s=, and the synset is represented by a synset-id which is
           the concatenation of the synset offset and the one-letter
           PoS tag.

Collocations are composed of their constituent tokens and an empty
token after the head of the collocation with the actual sense
annotation.

** conversion from original XML
The script that converts the original XML WN gloss corpus is at
=convert.lisp=. The MISC field of the annotation files saves lots of
information from the XML to preserve a mapping between them.

To re-run the conversion:

- download the [[http://wordnetcode.princeton.edu/glosstag.shtml][WordNet gloss corpus]];
- download the [[http://wordnetcode.princeton.edu/3.0/WNdb-3.0.tar.gz][WordNet 3.0 database files]];
- download and setup [[http://www.sbcl.org/][sbcl]] (although any common lisp implementation
  should work);
- setup [[https://www.quicklisp.org/beta/][quicklisp]];
- run:
  #+BEGIN_SRC sh
    sbcl --dynamic-space-size 7500Mb --load convert.lisp --load convert.lisp --eval '(time (xml->conllus (directory "merged/*.xml") "conllu/" "index.sense"))' --quit
  #+END_SRC
  where the =merged/= directory is from the gloss corpus archive, the
  =conllu= directory is where you want to put the files, and the
  =index.sense= file is from the WordNet database. (Use absolute paths
  if you have problems with the command.)


* Status
Under heavy development -- user interface is unstable, and the code is
still to be generalized so that it can be made useful for annotation
of other corpora (maybe even of other stuff).
